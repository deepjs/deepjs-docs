<div>
    <div id="submenu">
        <h2>deep query</h2>
        <div class="submenu-block" dp-control="js::/js/sub-nav.js">
            <ul>
                <li><a href="#intro">introduction</a></li>
                <li><a href="#deep-query">deep.query(...)</a></li>
                <li><a href="#chain-query">deep(...).query(...)</a></li>
                <li><a href="#query-node">query node</a>
                	<ul>
                		<li><a href="#node-content">node content</a></li>
                		<li><a href="#loop">loop warning</a></li>
                		<li><a href="#node-tools">tools</a></li>
                	</ul>
                </li>
                <li><a href="#relative">relative</a></li>
                <li><a href="#syntax">syntaxe</a>
                	<ul>
                		<li><a href="#start">start</a></li>
                		<li><a href="#move">move</a></li>
                		<li><a href="#select">select</a></li>
                		<li><a href="#length">@.length</a></li>
                		<li><a href="#filter">filter</a></li>
                	</ul>
                </li>
                <li><a href="#examples">examples</a></li>
            </ul>
        </div>
    </div>
    <div id="content">
        <div class="content">
<h3 id="intro">Intro</h3>

<p>Another proposal for json/object-query wich  :</p>
<ul>
<li>use simple <strong>slash delimitted</strong> syntax, </li>
<li>could handle <strong>regular expression</strong> for step selection, </li>
<li>could handle <strong>RQL (for filtering)</strong> on each step selection,</li>
<li>could be <strong>relative</strong> to where the query are placed in a object/json</li>
<li>so could handle steps toward <strong>any ancestor</strong></li>
<li>could handle <strong>json-schema</strong> in RQL filtering</li>
</ul>

<p>And above all, that could return full descriptors of selected properties (i.e. <a href="#query-node">deep_query_nodes</a>). It allow us to manage 'up' and 'bottom' (we need ancestor in many cases), schema validation, sub or ancestor query, function call with no change of context, etc...</p>

<h3 id="deep-query">deep.query(obj, query)</h3>
<p>Direct syntax through deep.query.</p>

<div class="dp-example">
    <pre dp-try class="dp-box code">
var obj = {
	a:1,
	b:true,
	c:"hello",
	d:{
		e:"world"
	}
};
// From root : Select the property 'd' then give me the property 'e' in it
var r = deep.query(obj, "/d/e"); 
deep.log('"/d/e" :\n', r);	// 'world'

// From root : give me all property wich is a string
r = deep.query(obj, "//?_type=string"); 
deep.log('\n"//?_type=string" :\n', r);	// ['hello', 'world']
</pre>
</div>

<h3 id="chain-query">deep(obj).query(q)...</h3>

<p>Chained call through <a href="/chains/deep">deep chain</a>.</p>
<div class="dp-example">
    <pre dp-try class="dp-box code">
deep({
	a:1,
	b:true,
	c:"hello",
	d:{
		e:"world"
	}
})
// From root : Select the property 'd' then give me the property 'e' in it
.query("/d/e")
.log('"/d/e" :\n')		// 'world'

// From root : give me all property wich is a string
.query("//?_type=string")
.log('\n"//?_type=string" :\n');	// ['hello', 'world']
</pre>
</div>


<h3 id="query-node">Query Node</h3>
<p>All this work with deep_query_nodes.</p>
<p>Such node contains all informations on selected properties, and allow to manipulate associated json-schema or ancestor of those properties.</p>
<h4 id="node-content">Node content </h4>

<h4 id="loop">Loop warning </h4>

<h4 id="node-tools">Tools</h4>

<h3 id="relative">relative vs root</h3>

<p>When you apply a query on a query-results-set (previously produced), you could navigate relatively to current(s) node(s), or restart queries from the root object.</p>

<div class="dp-example">
    <pre dp-try class="dp-box code">
deep({
	a:1,
	b:true,
	c:"hello",
	d:{
		e:"world"
	}
})
.query("/d")
.log("/d =")

.query("./e")
.log("\n/d/e =")

.query("../../b")
.log("\n/b =")

.query("/")
.log("\n/ =")

</pre>
</div>

<h3 id="syntax">Syntaxe </h3>

A query consist of succession of steps.

A step is : 
[move] [selector] [?rql]


            <div class="dp-example">
                <pre dp-try class="dp-box code">
deep({})
                </pre>
            </div>

<h4 id="start">start (first move) </h4>
<p>When you start a query : you could use any of those move to place play-head somewhere relatively to current node.</p>

<ul>
<li><strong>/</strong> : start from root</li>
<li><strong>./</strong>	: start from me (from somewhere in a json/object)</li>
<li><strong>../</strong> : start from my parent (from somewhere in a json/object)</li>
<li><strong>//</strong> : start from root and give me any properties at any sub level</li>
</ul>

<h4 id="move">move </h4>

/ 		current level
//		recursively seek any property from current level
../		take my parent level (you could select any of its properties from there)
../!	take my parent reference (you need to add '/' (e.g. ../!/) to select any of its properties as above))
/!		will give you current reference


<h4 id="select">step selector </h4>


<p>any step selector is either a direct string, or an int (array index) or a regular expression, or a union of them (expressed as a coma separated list of them surrounded with square brackets).</p>
<p>You could express range of array indexes as 0:10:2 which says : take items from 0 to 10 (included) by step of two. (see examples below for optionals placement)</p>
<p>Regular expression are always surrounded by parenthesis, and could be ended with 'g', 'i' or 'gi'.</p>

<p>examples of valid selectors : </p>
<ul>
	<li>1</li>
	<li>foo</li>
	<li>(foo.*)</li>
	<li>[0:20:2]</li>
	<li>[:]</li>
	<li>[1:,hello,(^prop.*)gi]</li>
</ul>

query example :
/foo/1/(^bar)/[::2]
<p>Say : give me foo from root,</p>
<p>on this, give the first items (or any property called '1'),</p>
<p>on this, give me any property named bar... ,</p>
<p>on this, get all items by step of two (if any). (it's the result of the query) </p>


<p>All those below are equivalent and say : give me all properties or items of the last move</p>
<ul>
	<li>/(.*)</li>
	<li>/*</li>
	<li>/[]</li>
	<li>/</li>
</ul>
<h4 id="length">@.length</h4>

<p>In array brackets access : you could use @.length to get the length (if any) of the parent IF IT'S AN ARRAY.</p>
//[@.length-1]  
<p>will give you any last array childs at any level from root.</p>

//length
<p>will give you any array length at any level from root (or any 'length' property founded in the json/object)</p>
<p>In deep-rql : length could also give you the length of the strings.</p>


<h4 id="filter">filter</h4>

<p>any RQL filter (deep-rql : see its doc for full description) could be added to any selector.</p>

/foo?=gt=12
give me foo property from root only if it's greater than 12

//address?zip=1190
give me any adress which contains a zip equal to 1190

//category?distinct()&amp;sort(-)
give me any distinct category and sort them descendant

<h3 id="examples">Examples</h3>



        </div>
    </div>
</div>




